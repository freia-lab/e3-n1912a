# Protocol file for Keysight N1912A power meter

Terminator = LF;
#ReadTimeout = 200;

ReplyTimeout = 5000;

DELAY = 50;

P = "HPRF-PwrMtr:";
DEV = "N1912A";

get_id {
   out "*idn?";
   in "%#s";
   @init { out "*idn?";
   	 in "%#s"; }
}

get_err {
   out "syst:err?";
   in "%(" $P $DEV ":SystErr)#s";
}

reset {
   out "*RST";
   
   out "syst:err?";
   in "0,\"No error;0;0 0\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}  
}

# query power

fetch_power {
   out "FETC\$1:POW:AC?";
   wait $DELAY;
   in "%f";
}

#switch {
#   out "SENS\$1:CORR:GAIN2:STAT %{OFF|ON}";
#}

# enable/disable a channel offset for the power meter setup

set_offset_status {
   out "SENS\$1:CORR:GAIN2:STAT %i";
#   in "%#s";
#   @init { out "INST OUT\$1";
#           out "OUTP?";
#   	 in "%i"; }
#   @mismatch {in "%(\$2:SystErr)#s";}
}

# query channel offset for the power meter setup
# returns 0 or 1

get_offset_status {
   out "SENS\$1:CORR:GAIN2:STAT?";
   in "%i";
   @init { out "SENS\$1:CORR:GAIN2:STAT?";
   	 in "%i"; }
}
